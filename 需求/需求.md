# 需求

## 场景

1. 场景：前端提供上传界面让用户上传word文档（不考虑断点重传），后端自动解析word文档中的表格的xml（考虑使用ZipFile拉取所有表格的xml以及对应的style的xml，核心分割部分实现先用TODO代替），然后将表格完整结构以及style作为metadata，将文件名+表格的顺序序号作为document_content存入chroma数据库。
2. 场景：前端展示界面用户输入关键字（变换关键字，已经选择的表格不会变，所以需要前端做存储），关键字传到后端做相似度匹配，将匹配的表格的xml转换成html（用TODO代替），返回给前端，需要支持一次返回若干个表格的html（先默认4个），返回后在前端使用iframe进行展示，前端展示界面中主展示界面中表格只展示一个，前端界面下方展示所有匹配表格的预览（可以通过点击切换），前端展示界面中主展示界面和下方展示所有匹配表格的预览的组件都要支持用户勾选（使用+号按钮，因为同一个表格可能需要多个），勾选后在前端通过sessionStorage记录和更新用户勾选的表格id，选择后，在界面右侧提供顺序调换面板（支持收起和展开），用户可以调整表格顺序（调整后自动记录到sessionStorage）。前端展示界面提供确认下载按钮，用户点击后前端将表格ID数组作为参数传给后端，后端按数组的元素顺序从chroma中拉取表格，再组装成一个docx文档，生成一个blob格式的响应，前端将blob生成下载链接，通过window.URL.revokeObjectURL(url);触发浏览器的下载。然后删除sessionStorage中的表格顺序，回到首页

## 技术

1. 技术选型，前端使用VUE2，后端选用python，使用向量数据库chroma来缓存图片数据，暂时不需要登录界面，因为是demo，暂时不需要接入mysql、mongo和redis等数据库
2. 表格xml转换成html和html转换成xml都使用正则做标签名替换
3. 前端在文件上传时只能上传.docx文件，.pdf和.doc都不支持
4. 表格相关处理请参考表格样式提取指南.md

## 前端(table-construct-front)

1. 前端分为两个页面，上传页面和展示页面，要求在界面中提供导航按钮实现页面的切换

## 后端(table-construct-back)

1. 后端需要提供上传接口、下载接口、查询接口
2. 上传接口（/upload）只实现表格以及表格前三个段落（w:p）以及后一个段落（w:p）的提取，后续分割逻辑写个TODO，分割后根据表格和表格相关的段落查询对应的样式，最后将表格及段落的xml和样式的xml作为metadata，以文件名+表格的顺序序号作为document_content存入chromadb
3. 下载接口（/download）要求参考表格样式提取指南.md从chroma查出表格的xml和style然后组装成新的.docx文件并以blob格式返回
4. 查询接口（/page）要求前端传入page_num, page_size, query，用chromadb.query查出对应的表格，后续将xml转换成html的处理写个TODO，最后将处理完后的所有列表装入数组封装到response中返回给前端